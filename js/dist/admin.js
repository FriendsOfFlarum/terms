(()=>{var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";e.r(t),e.d(t,{components:()=>ge,helpers:()=>ye,models:()=>ve});const r=flarum.core.compat["admin/app"];var n=e.n(r);function o(e,t){return o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},o(e,t)}function i(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,o(e,t)}const a=flarum.core.compat["common/Model"];var s=e.n(a);const l=flarum.core.compat["common/utils/computed"];var c=e.n(l),d=function(e){function t(){for(var t,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(t=e.call.apply(e,[this].concat(n))||this).sort=s().attribute("sort"),t.name=s().attribute("name"),t.url=s().attribute("url"),t.update_message=s().attribute("update_message"),t.terms_updated_at=s().attribute("terms_updated_at"),t.form_key=c()("id",(function(e){return"fof_terms_policy_"+e})),t}return i(t,e),t.prototype.apiEndpoint=function(){return"/fof/terms/policies"+(this.exists?"/"+this.data.id:"")},t}(s());const u=flarum.core.compat["admin/components/ExtensionPage"];var f=e.n(u);const p=flarum.core.compat["common/components/Switch"];var h=e.n(p);function g(e,t,r){if(void 0===r)return e&&e.h5s&&e.h5s.data&&e.h5s.data[t];e.h5s=e.h5s||{},e.h5s.data=e.h5s.data||{},e.h5s.data[t]=r}var v=function(e,t){if(!(e instanceof NodeList||e instanceof HTMLCollection||e instanceof Array))throw new Error("You must provide a nodeList/HTMLCollection/Array of elements to be filtered.");return"string"!=typeof t?Array.from(e):Array.from(e).filter((function(e){return 1===e.nodeType&&e.matches(t)}))},y=new Map,b=function(){function e(){this._config=new Map,this._placeholder=void 0,this._data=new Map}return Object.defineProperty(e.prototype,"config",{get:function(){var e={};return this._config.forEach((function(t,r){e[r]=t})),e},set:function(e){if("object"!=typeof e)throw new Error("You must provide a valid configuration object to the config setter.");var t=Object.assign({},e);this._config=new Map(Object.entries(t))},enumerable:!1,configurable:!0}),e.prototype.setConfig=function(e,t){if(!this._config.has(e))throw new Error("Trying to set invalid configuration item: "+e);this._config.set(e,t)},e.prototype.getConfig=function(e){if(!this._config.has(e))throw new Error("Invalid configuration item requested: "+e);return this._config.get(e)},Object.defineProperty(e.prototype,"placeholder",{get:function(){return this._placeholder},set:function(e){if(!(e instanceof HTMLElement)&&null!==e)throw new Error("A placeholder must be an html element or null.");this._placeholder=e},enumerable:!1,configurable:!0}),e.prototype.setData=function(e,t){if("string"!=typeof e)throw new Error("The key must be a string.");this._data.set(e,t)},e.prototype.getData=function(e){if("string"!=typeof e)throw new Error("The key must be a string.");return this._data.get(e)},e.prototype.deleteData=function(e){if("string"!=typeof e)throw new Error("The key must be a string.");return this._data.delete(e)},e}(),w=function(e){if(!(e instanceof HTMLElement))throw new Error("Please provide a sortable to the store function.");return y.has(e)||y.set(e,new b),y.get(e)};function E(e,t,r){if(e instanceof Array)for(var n=0;n<e.length;++n)E(e[n],t,r);else e.addEventListener(t,r),w(e).setData("event"+t,r)}function T(e,t){if(e instanceof Array)for(var r=0;r<e.length;++r)T(e[r],t);else e.removeEventListener(t,w(e).getData("event"+t)),w(e).deleteData("event"+t)}function x(e,t,r){if(e instanceof Array)for(var n=0;n<e.length;++n)x(e[n],t,r);else e.setAttribute(t,r)}function C(e,t){if(e instanceof Array)for(var r=0;r<e.length;++r)C(e[r],t);else e.removeAttribute(t)}var _,F,L,P,S,A,M,D,I,H=function(e){if(!e.parentElement||0===e.getClientRects().length)throw new Error("target element must be part of the dom");var t=e.getClientRects()[0];return{left:t.left+window.pageXOffset,right:t.right+window.pageXOffset,top:t.top+window.pageYOffset,bottom:t.bottom+window.pageYOffset}},O=function(e,t){if(!(e instanceof HTMLElement&&(t instanceof NodeList||t instanceof HTMLCollection||t instanceof Array)))throw new Error("You must provide an element and a list of elements.");return Array.from(t).indexOf(e)},Y=function(e){if(!(e instanceof HTMLElement))throw new Error("Element is not a node element.");return null!==e.parentNode},j=function(e,t,r){if(!(e instanceof HTMLElement&&e.parentElement instanceof HTMLElement))throw new Error("target and element must be a node");e.parentElement.insertBefore(t,"before"===r?e:e.nextElementSibling)},B=function(e,t){return j(e,t,"after")},N=function(e){if(!(e instanceof HTMLElement))throw new Error("You must provide a valid dom element");var t=window.getComputedStyle(e);return"border-box"===t.getPropertyValue("box-sizing")?parseInt(t.getPropertyValue("height"),10):["height","padding-top","padding-bottom"].map((function(e){var r=parseInt(t.getPropertyValue(e),10);return isNaN(r)?0:r})).reduce((function(e,t){return e+t}))},k=function(e){if(!(e instanceof HTMLElement))throw new Error("You must provide a valid dom element");var t=window.getComputedStyle(e);return["width","padding-left","padding-right"].map((function(e){var r=parseInt(t.getPropertyValue(e),10);return isNaN(r)?0:r})).reduce((function(e,t){return e+t}))},z=function(e,t){if(!(e instanceof Array))throw new Error("You must provide a Array of HTMLElements to be filtered.");return"string"!=typeof t?e:e.filter((function(e){return e.querySelector(t)instanceof HTMLElement||e.shadowRoot&&e.shadowRoot.querySelector(t)instanceof HTMLElement})).map((function(e){return e.querySelector(t)||e.shadowRoot&&e.shadowRoot.querySelector(t)}))},q=function(e){return e.composedPath&&e.composedPath()[0]||e.target},W=function(e,t,r){return{element:e,posX:r.pageX-t.left,posY:r.pageY-t.top}},R=function(e,t){if(!0===e.isSortable){var r=w(e).getConfig("acceptFrom");if(null!==r&&!1!==r&&"string"!=typeof r)throw new Error('HTML5Sortable: Wrong argument, "acceptFrom" must be "null", "false", or a valid selector string.');if(null!==r)return!1!==r&&r.split(",").filter((function(e){return e.length>0&&t.matches(e)})).length>0;if(e===t)return!0;if(void 0!==w(e).getConfig("connectWith")&&null!==w(e).getConfig("connectWith"))return w(e).getConfig("connectWith")===w(t).getConfig("connectWith")}return!1},U={items:null,connectWith:null,disableIEFix:null,acceptFrom:null,copy:!1,placeholder:null,placeholderClass:"sortable-placeholder",draggingClass:"sortable-dragging",hoverClass:!1,dropTargetContainerClass:!1,debounce:0,throttleTime:100,maxItems:0,itemSerializer:void 0,containerSerializer:void 0,customDragImage:null,orientation:"vertical"},X=function(e){T(e,"dragstart"),T(e,"dragend"),T(e,"dragover"),T(e,"dragenter"),T(e,"drop"),T(e,"mouseenter"),T(e,"mouseleave")},G=function(e,t){e&&T(e,"dragleave"),t&&t!==e&&T(t,"dragleave")},V=function(e){var t;(t=e).h5s&&delete t.h5s.data,C(e,"aria-dropeffect")},J=function(e){C(e,"aria-grabbed"),C(e,"aria-copied"),C(e,"draggable"),C(e,"role")};function K(e,t){if(t.composedPath)return t.composedPath().find((function(e){return e.isSortable}));for(;!0!==e.isSortable;)e=e.parentElement;return e}function Q(e,t){var r=g(e,"opts"),n=v(e.children,r.items).filter((function(e){return e.contains(t)||e.shadowRoot&&e.shadowRoot.contains(t)}));return n.length>0?n[0]:t}var Z=function(e){var t=g(e,"opts"),r=v(e.children,t.items),n=z(r,t.handle);x(e,"aria-dropeffect","move"),g(e,"_disabled","false"),x(n,"draggable","true"),!1===t.disableIEFix&&"function"==typeof(document||window.document).createElement("span").dragDrop&&E(n,"mousedown",(function(){if(-1!==r.indexOf(this))this.dragDrop();else{for(var e=this.parentElement;-1===r.indexOf(e);)e=e.parentElement;e.dragDrop()}}))};function $(e,t){var r=String(t);return t=t||{},"string"==typeof e&&(e=document.querySelectorAll(e)),e instanceof HTMLElement&&(e=[e]),e=Array.prototype.slice.call(e),/serialize/.test(r)?e.map((function(e){var t=g(e,"opts");return function(e,t,r){if(void 0===t&&(t=function(e,t){return e}),void 0===r&&(r=function(e){return e}),!(e instanceof HTMLElement)||1==!e.isSortable)throw new Error("You need to provide a sortableContainer to be serialized.");if("function"!=typeof t||"function"!=typeof r)throw new Error("You need to provide a valid serializer for items and the container.");var n=g(e,"opts").items,o=v(e.children,n),i=o.map((function(t){return{parent:e,node:t,html:t.outerHTML,index:O(t,o)}}));return{container:r({node:e,itemCount:i.length}),items:i.map((function(r){return t(r,e)}))}}(e,t.itemSerializer,t.containerSerializer)})):(e.forEach((function(e){if(/enable|disable|destroy/.test(r))return $[r](e);["connectWith","disableIEFix"].forEach((function(e){Object.prototype.hasOwnProperty.call(t,e)&&null!==t[e]&&console.warn('HTML5Sortable: You are using the deprecated configuration "'+e+'". This will be removed in an upcoming version, make sure to migrate to the new options when updating.')})),t=Object.assign({},U,w(e).config,t),w(e).config=t,g(e,"opts",t),e.isSortable=!0,function(e){var t=g(e,"opts"),r=v(e.children,t.items),n=z(r,t.handle);g(e,"_disabled","false"),X(r),G(P,D),T(n,"mousedown"),T(e,"dragover"),T(e,"dragenter"),T(e,"drop")}(e);var n,o=v(e.children,t.items);if(null!==t.placeholder&&void 0!==t.placeholder){var i=document.createElement(e.tagName);t.placeholder instanceof HTMLElement?i.appendChild(t.placeholder):i.innerHTML=t.placeholder,n=i.children[0]}w(e).placeholder=function(e,t,r){var n;if(void 0===r&&(r="sortable-placeholder"),!(e instanceof HTMLElement))throw new Error("You must provide a valid element as a sortable.");if(!(t instanceof HTMLElement)&&void 0!==t)throw new Error("You must provide a valid element as a placeholder or set ot to undefined.");return void 0===t&&(["UL","OL"].includes(e.tagName)?t=document.createElement("li"):["TABLE","TBODY"].includes(e.tagName)?(t=document.createElement("tr")).innerHTML='<td colspan="100"></td>':t=document.createElement("div")),"string"==typeof r&&(n=t.classList).add.apply(n,r.split(" ")),t}(e,n,t.placeholderClass),g(e,"items",t.items),t.acceptFrom?g(e,"acceptFrom",t.acceptFrom):t.connectWith&&g(e,"connectWith",t.connectWith),Z(e),x(o,"role","option"),x(o,"aria-grabbed","false"),function(e,t){if("string"==typeof w(e).getConfig("hoverClass")){var r=w(e).getConfig("hoverClass").split(" ");!0===t?(E(e,"mousemove",function(e,t){var r=this;if(void 0===t&&(t=250),"number"!=typeof t)throw new Error("You must provide a number as the second argument for throttle.");var n=null;return function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];var a=Date.now();(null===n||a-n>=t)&&(n=a,e.apply(r,o))}}((function(t){0===t.buttons&&v(e.children,w(e).getConfig("items")).forEach((function(e){var n,o;e!==t.target?(n=e.classList).remove.apply(n,r):(o=e.classList).add.apply(o,r)}))}),w(e).getConfig("throttleTime"))),E(e,"mouseleave",(function(){v(e.children,w(e).getConfig("items")).forEach((function(e){var t;(t=e.classList).remove.apply(t,r)}))}))):(T(e,"mousemove"),T(e,"mouseleave"))}}(e,!0),E(e,"dragstart",(function(e){var r=q(e);if(!0!==r.isSortable&&(e.stopImmediatePropagation(),(!t.handle||r.matches(t.handle))&&"false"!==r.getAttribute("draggable"))){var n=K(r,e),o=Q(n,r);M=v(n.children,t.items),S=M.indexOf(o),A=O(o,n.children),P=n,function(e,t,r){if(!(e instanceof Event))throw new Error("setDragImage requires a DragEvent as the first argument.");if(!(t instanceof HTMLElement))throw new Error("setDragImage requires the dragged element as the second argument.");if(r||(r=W),e.dataTransfer&&e.dataTransfer.setDragImage){var n=r(t,H(t),e);if(!(n.element instanceof HTMLElement)||"number"!=typeof n.posX||"number"!=typeof n.posY)throw new Error("The customDragImage function you provided must return and object with the properties element[string], posX[integer], posY[integer].");e.dataTransfer.effectAllowed="copyMove",e.dataTransfer.setData("text/plain",q(e).id),e.dataTransfer.setDragImage(n.element,n.posX,n.posY)}}(e,o,t.customDragImage),F=N(o),L=k(o),o.classList.add(t.draggingClass),_=function(e,t){var r=e;return!0===w(t).getConfig("copy")&&(x(r=e.cloneNode(!0),"aria-copied","true"),e.parentElement.appendChild(r),r.style.display="none",r.oldDisplay=e.style.display),r}(o,n),x(_,"aria-grabbed","true"),n.dispatchEvent(new CustomEvent("sortstart",{detail:{origin:{elementIndex:A,index:S,container:P},item:_,originalTarget:r}}))}})),E(e,"dragenter",(function(r){var n=q(r),o=K(n,r);o&&o!==D&&(I=v(o.children,g(o,"items")).filter((function(t){return t!==w(e).placeholder})),t.dropTargetContainerClass&&o.classList.add(t.dropTargetContainerClass),o.dispatchEvent(new CustomEvent("sortenter",{detail:{origin:{elementIndex:A,index:S,container:P},destination:{container:o,itemsBeforeUpdate:I},item:_,originalTarget:n}})),E(o,"dragleave",(function(e){var r=e.relatedTarget||e.fromElement;e.currentTarget.contains(r)||(t.dropTargetContainerClass&&o.classList.remove(t.dropTargetContainerClass),o.dispatchEvent(new CustomEvent("sortleave",{detail:{origin:{elementIndex:A,index:S,container:o},item:_,originalTarget:n}})))}))),D=o})),E(e,"dragend",(function(r){if(_){_.classList.remove(t.draggingClass),x(_,"aria-grabbed","false"),"true"===_.getAttribute("aria-copied")&&"true"!==g(_,"dropped")&&_.remove(),_.style.display=_.oldDisplay,delete _.oldDisplay;var n=Array.from(y.values()).map((function(e){return e.placeholder})).filter((function(e){return e instanceof HTMLElement})).filter(Y)[0];n&&n.remove(),e.dispatchEvent(new CustomEvent("sortstop",{detail:{origin:{elementIndex:A,index:S,container:P},item:_}})),D=null,_=null,F=null,L=null}})),E(e,"drop",(function(r){if(R(e,_.parentElement)){r.preventDefault(),r.stopPropagation(),g(_,"dropped","true");var n=Array.from(y.values()).map((function(e){return e.placeholder})).filter((function(e){return e instanceof HTMLElement})).filter(Y)[0];B(n,_),n.remove(),e.dispatchEvent(new CustomEvent("sortstop",{detail:{origin:{elementIndex:A,index:S,container:P},item:_}}));var o=w(e).placeholder,i=v(P.children,t.items).filter((function(e){return e!==o})),a=!0===this.isSortable?this:this.parentElement,s=v(a.children,g(a,"items")).filter((function(e){return e!==o})),l=O(_,Array.from(_.parentElement.children).filter((function(e){return e!==o}))),c=O(_,s);t.dropTargetContainerClass&&a.classList.remove(t.dropTargetContainerClass),A===l&&P===a||e.dispatchEvent(new CustomEvent("sortupdate",{detail:{origin:{elementIndex:A,index:S,container:P,itemsBeforeUpdate:M,items:i},destination:{index:c,elementIndex:l,container:a,itemsBeforeUpdate:I,items:s},item:_}}))}}));var a,s,l,c=(a=function(e,r,n,o){if(_)if(t.forcePlaceholderSize&&(w(e).placeholder.style.height=F+"px",w(e).placeholder.style.width=L+"px"),Array.from(e.children).indexOf(r)>-1){var i=N(r),a=k(r),s=O(w(e).placeholder,r.parentElement.children),l=O(r,r.parentElement.children);if(i>F||a>L){var c=i-F,d=a-L,u=H(r).top,f=H(r).left;if(s<l&&("vertical"===t.orientation&&o<u||"horizontal"===t.orientation&&n<f))return;if(s>l&&("vertical"===t.orientation&&o>u+i-c||"horizontal"===t.orientation&&n>f+a-d))return}void 0===_.oldDisplay&&(_.oldDisplay=_.style.display),"none"!==_.style.display&&(_.style.display="none");var m=!1;try{var p=H(r).top+r.offsetHeight/2,h=H(r).left+r.offsetWidth/2;m="vertical"===t.orientation&&o>=p||"horizontal"===t.orientation&&n>=h}catch(e){m=s<l}m?B(r,w(e).placeholder):function(e,t){j(e,t,"before")}(r,w(e).placeholder),Array.from(y.values()).filter((function(e){return void 0!==e.placeholder})).forEach((function(t){t.placeholder!==w(e).placeholder&&t.placeholder.remove()}))}else{var g=Array.from(y.values()).filter((function(e){return void 0!==e.placeholder})).map((function(e){return e.placeholder}));-1!==g.indexOf(r)||e!==r||v(r.children,t.items).length||(g.forEach((function(e){return e.remove()})),r.appendChild(w(e).placeholder))}},void 0===(s=t.debounce)&&(s=0),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];clearTimeout(l),l=setTimeout((function(){a.apply(void 0,e)}),s)}),d=function(e){var t=e.target,r=!0===t.isSortable?t:K(t,e);if(t=Q(r,t),_&&R(r,_.parentElement)&&"true"!==g(r,"_disabled")){var n=g(r,"opts");parseInt(n.maxItems)&&v(r.children,g(r,"items")).length>=parseInt(n.maxItems)&&_.parentElement!==r||(e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect=!0===w(r).getConfig("copy")?"copy":"move",c(r,t,e.pageX,e.pageY))}};E(o.concat(e),"dragover",d),E(o.concat(e),"dragenter",d)})),e)}$.destroy=function(e){!function(e){var t=g(e,"opts")||{},r=v(e.children,t.items),n=z(r,t.handle);T(e,"dragover"),T(e,"dragenter"),T(e,"dragstart"),T(e,"dragend"),T(e,"drop"),V(e),T(n,"mousedown"),X(r),J(r),G(P,D),e.isSortable=!1}(e)},$.enable=function(e){Z(e)},$.disable=function(e){!function(e){var t=g(e,"opts"),r=v(e.children,t.items),n=z(r,t.handle);x(e,"aria-dropeffect","none"),g(e,"_disabled","true"),x(n,"draggable","false"),T(n,"mousedown")}(e)},$.__testing={_data:g,_removeItemEvents:X,_removeItemData:J,_removeSortableData:V,_removeContainerEvents:G};const ee=$,te=flarum.core.compat["common/helpers/icon"];var re=e.n(te);const ne=flarum.core.compat["common/utils/extractText"];var oe=e.n(ne);const ie=flarum.core.compat["common/utils/ItemList"];var ae=e.n(ie);const se=flarum.core.compat["common/utils/withAttr"];var le=e.n(se);const ce=flarum.core.compat["common/components/Button"];var de=e.n(ce),ue=function(){function e(){}var t=e.prototype;return t.oninit=function(e){this.policy=e.attrs.policy,this.dirty=!1,this.processing=!1,this.toggleFields=!1,null===this.policy&&this.initNewField()},t.initNewField=function(){this.policy=n().store.createRecord("fof-terms-policies",{attributes:{name:"",url:"",update_message:"",terms_updated_at:""}})},t.boxTitle=function(){return this.policy.exists?this.policy.name():n().translator.trans("fof-terms.admin.buttons.new-policy")},t.view=function(){var e=this;return m(".FoF-Terms-Policiy-Box",[this.policy.exists?m("span.fas.fa-arrows-alt.FoF-Terms-Policiy-Box--handle.js-policy-handle"):null,m(".Button.Button--block.FoF-Terms-Policiy-Header",{onclick:function(){e.toggleFields=!e.toggleFields}},[m(".FoF-Terms-Policiy-Header-Title",this.boxTitle()),m("div",[this.policy.exists?[n().translator.trans("fof-terms.admin.buttons.edit-policy")," "]:null,re()(this.toggleFields?"fas fa-chevron-up":"fas fa-chevron-down")])]),this.toggleFields?this.viewFields():null])},t.viewFields=function(){return m("form.FoF-Terms-Policiy-Body",{onsubmit:this.savePolicy.bind(this)},[this.fields().toArray(),m(".ButtonGroup",[de().component({type:"submit",className:"Button Button--primary",loading:this.processing,disabled:!this.readyToSave()},n().translator.trans("fof-terms.admin.buttons."+(this.policy.exists?"save":"add")+"-policy")),this.policy.exists?de().component({type:"submit",className:"Button Button--danger",loading:this.processing,onclick:this.deletePolicy.bind(this)},n().translator.trans("fof-terms.admin.buttons.delete-policy")):""])])},t.fields=function(){var e=this,t=new(ae());return t.add("name",m(".Form-group",[m("label",n().translator.trans("fof-terms.admin.policies.name")),m("input.FormControl",{type:"text",value:this.policy.name(),oninput:le()("value",this.updateAttribute.bind(this,"name"))}),m(".helpText",n().translator.trans("fof-terms.admin.policies.name-help"))]),100),t.add("url",m(".Form-group",[m("label",n().translator.trans("fof-terms.admin.policies.url")),m("input.FormControl",{type:"url",value:this.policy.url(),oninput:le()("value",this.updateAttribute.bind(this,"url"))}),m(".helpText",n().translator.trans("fof-terms.admin.policies.url-help"))]),95),t.add("update-message",m(".Form-group",[m("label",n().translator.trans("fof-terms.admin.policies.update-message")),m("textarea.FormControl",{value:this.policy.update_message(),oninput:le()("value",this.updateAttribute.bind(this,"update_message"))}),m(".helpText",n().translator.trans("fof-terms.admin.policies.update-message-help"))]),90),t.add("terms-updated-at",m(".Form-group",[m("label",n().translator.trans("fof-terms.admin.policies.terms-updated-at")),m(".FoF-Terms-Input-Group",[m("input.FormControl",{type:"text",value:this.policy.terms_updated_at(),oninput:le()("value",this.updateAttribute.bind(this,"terms_updated_at")),placeholder:n().translator.trans("fof-terms.admin.policies.terms-updated-at-placeholder")}),de().component({className:"Button Button--primary",onclick:function(){e.updateAttribute("terms_updated_at",dayjs().millisecond(0).toISOString())}},n().translator.trans("fof-terms.admin.buttons.set-to-now"))]),m(".helpText",n().translator.trans("fof-terms.admin.policies.terms-updated-at-help"))]),85),this.policy.exists&&t.add("export-url",m(".Form-group",[m("label",n().translator.trans("fof-terms.admin.policies.export-url")),m(".ButtonGroup",["json","csv"].map((function(t){return m("a.Button.FoF-Terms-Export-Button",{href:n().forum.attribute("apiUrl")+"/fof/terms/policies/"+e.policy.id()+"/export."+t,target:"_blank"},t.toUpperCase())}))),m(".helpText",n().translator.trans("fof-terms.admin.policies.export-url-help",{a:m("a",{href:"https://github.com/FriendsOfFlarum/terms/wiki/Export-url",target:"_blank"})}))]),80),t},t.updateAttribute=function(e,t){var r;this.policy.pushAttributes(((r={})[e]=t,r)),this.dirty=!0},t.readyToSave=function(){return this.dirty},t.savePolicy=function(e){var t=this;e.preventDefault(),this.processing=!0;var r=!this.policy.exists;this.policy.save(this.policy.data.attributes).then((function(){r&&(t.initNewField(),t.toggleFields=!1),t.processing=!1,t.dirty=!1,m.redraw()})).catch((function(e){throw t.processing=!1,e}))},t.deletePolicy=function(){var e=this;confirm(oe()(n().translator.trans("fof-terms.admin.messages.delete-policy-confirmation",{name:this.policy.name()})))&&(this.processing=!0,this.policy.delete().then((function(){e.processing=!1,m.redraw()})).catch((function(t){throw e.processing=!1,t})))},e}();function fe(e,t){return void 0===t&&(t="sort"),e.sort((function(e,r){return e[t]()-r[t]()}))}var me=function(){function e(){}var t=e.prototype;return t.oninit=function(){n().request({method:"GET",url:n().forum.attribute("apiUrl")+"/fof/terms/policies"}).then((function(e){n().store.pushPayload(e),m.redraw()}))},t.oncreate=function(e){this.initsortable(e)},t.onupdate=function(e){this.initsortable(e)},t.initsortable=function(e){var t=this;ee(e.dom.querySelector(".js-policies-container"),{handle:".js-policy-handle"})[0].addEventListener("sortupdate",(function(){var r=[].map.call(e.dom.querySelectorAll(".js-policy-data"),(function(e){return e.dataset.id}));t.updateSort(r)}))},t.view=function(){var e=n().store.all("fof-terms-policies"),t=[];return fe(e).forEach((function(e){t.push(m(".js-policy-data",{key:e.id(),"data-id":e.id()},m(ue,{policy:e})))})),m("div",[m("h2",n().translator.trans("fof-terms.admin.titles.policies")),m(".FoF-Terms-Policies-Container",[m(".js-policies-container",t),m(ue,{policy:null})])])},t.updateSort=function(e){n().request({method:"POST",url:n().forum.attribute("apiUrl")+"/fof/terms/policies/order",body:{sort:e}}).then((function(e){n().store.pushPayload(e),m.redraw()}))},e}(),pe="fof-terms.admin.settings.",he=function(e){function t(){return e.apply(this,arguments)||this}return i(t,e),t.prototype.content=function(){return m(".ExtensionPage-settings",[m(".container",[m(".Form-group",[m("label",n().translator.trans(pe+"field.signup-legal-text")),m("textarea.FormControl",{bidi:this.setting("fof-terms.signup-legal-text")})]),m(".Form-group",[m("label",h().component({state:this.setting("fof-terms.hide-updated-at")()>0,onchange:this.setting("fof-terms.hide-updated-at")},n().translator.trans(pe+"field.hide-updated-at")))]),m(".Form-group",[m("label",n().translator.trans(pe+"field.date-format")),m("input[type=text].FormControl",{bidi:this.setting("fof-terms.date-format"),placeholder:"YYYY-MM-DD"}),m(".helpText",n().translator.trans(pe+"field.date-format-help",{a:m("a",{href:"https://day.js.org/docs/en/display/format",target:"_blank"})}))]),this.submitButton(),m(me)])])},t}(f()),ge={PolicyEdit:ue,PolicyList:me,TermsSettingsPage:he},ve={Policy:d},ye={sortByAttribute:fe};n().initializers.add("fof-terms",(function(){n().store.models["fof-terms-policies"]=d,n().extensionData.for("fof-terms").registerPermission({icon:"fas fa-paperclip",label:n().translator.trans("fof-terms.admin.permissions.see-user-policies-state"),permission:"fof-terms.see-user-policies-state"},"moderate").registerPermission({icon:"fas fa-paperclip",label:n().translator.trans("fof-terms.admin.permissions.postpone-policies-accept"),permission:"fof-terms.postpone-policies-accept"},"moderate").registerPermission({icon:"fas fa-paperclip",label:n().translator.trans("fof-terms.admin.permissions.export-policies"),permission:"fof-terms.export-policies"},"moderate").registerPage(he)}))})(),module.exports=t})();
//# sourceMappingURL=admin.js.map