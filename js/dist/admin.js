(()=>{var t={n:e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return t.d(r,{a:r}),r},d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";t.r(e),t.d(e,{components:()=>bt,helpers:()=>Et,models:()=>wt});const r=flarum.core.compat["admin/app"];var n=t.n(r);function o(t,e){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},o(t,e)}function i(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,o(t,e)}const a=flarum.core.compat["common/Model"];var s=t.n(a);const l=flarum.core.compat["common/utils/computed"];var c=t.n(l),d=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).sort=s().attribute("sort"),e.name=s().attribute("name"),e.url=s().attribute("url"),e.update_message=s().attribute("update_message"),e.terms_updated_at=s().attribute("terms_updated_at"),e.optional=s().attribute("optional"),e.additional_info=s().attribute("additional_info"),e.form_key=c()("id",(function(t){return"fof_terms_policy_"+t})),e}return i(e,t),e.prototype.apiEndpoint=function(){return"/fof/terms/policies"+(this.exists?"/"+this.data.id:"")},e}(s());const u=flarum.core.compat["admin/components/ExtensionPage"];var p=t.n(u);const f=flarum.core.compat["common/components/Switch"];var h=t.n(f);function g(t,e,r){if(void 0===r)return t&&t.h5s&&t.h5s.data&&t.h5s.data[e];t.h5s=t.h5s||{},t.h5s.data=t.h5s.data||{},t.h5s.data[e]=r}var v=function(t,e){if(!(t instanceof NodeList||t instanceof HTMLCollection||t instanceof Array))throw new Error("You must provide a nodeList/HTMLCollection/Array of elements to be filtered.");return"string"!=typeof e?Array.from(t):Array.from(t).filter((function(t){return 1===t.nodeType&&t.matches(e)}))},y=new Map,b=function(){function t(){this._config=new Map,this._placeholder=void 0,this._data=new Map}return Object.defineProperty(t.prototype,"config",{get:function(){var t={};return this._config.forEach((function(e,r){t[r]=e})),t},set:function(t){if("object"!=typeof t)throw new Error("You must provide a valid configuration object to the config setter.");var e=Object.assign({},t);this._config=new Map(Object.entries(e))},enumerable:!1,configurable:!0}),t.prototype.setConfig=function(t,e){if(!this._config.has(t))throw new Error("Trying to set invalid configuration item: "+t);this._config.set(t,e)},t.prototype.getConfig=function(t){if(!this._config.has(t))throw new Error("Invalid configuration item requested: "+t);return this._config.get(t)},Object.defineProperty(t.prototype,"placeholder",{get:function(){return this._placeholder},set:function(t){if(!(t instanceof HTMLElement)&&null!==t)throw new Error("A placeholder must be an html element or null.");this._placeholder=t},enumerable:!1,configurable:!0}),t.prototype.setData=function(t,e){if("string"!=typeof t)throw new Error("The key must be a string.");this._data.set(t,e)},t.prototype.getData=function(t){if("string"!=typeof t)throw new Error("The key must be a string.");return this._data.get(t)},t.prototype.deleteData=function(t){if("string"!=typeof t)throw new Error("The key must be a string.");return this._data.delete(t)},t}(),w=function(t){if(!(t instanceof HTMLElement))throw new Error("Please provide a sortable to the store function.");return y.has(t)||y.set(t,new b),y.get(t)};function E(t,e,r){if(t instanceof Array)for(var n=0;n<t.length;++n)E(t[n],e,r);else t.addEventListener(e,r),w(t).setData("event"+e,r)}function T(t,e){if(t instanceof Array)for(var r=0;r<t.length;++r)T(t[r],e);else t.removeEventListener(e,w(t).getData("event"+e)),w(t).deleteData("event"+e)}function x(t,e,r){if(t instanceof Array)for(var n=0;n<t.length;++n)x(t[n],e,r);else t.setAttribute(e,r)}function C(t,e){if(t instanceof Array)for(var r=0;r<t.length;++r)C(t[r],e);else t.removeAttribute(e)}var _,F,L,A,P,S,M,D,I,O=function(t){if(!t.parentElement||0===t.getClientRects().length)throw new Error("target element must be part of the dom");var e=t.getClientRects()[0];return{left:e.left+window.pageXOffset,right:e.right+window.pageXOffset,top:e.top+window.pageYOffset,bottom:e.bottom+window.pageYOffset}},H=function(t,e){if(!(t instanceof HTMLElement&&(e instanceof NodeList||e instanceof HTMLCollection||e instanceof Array)))throw new Error("You must provide an element and a list of elements.");return Array.from(e).indexOf(t)},j=function(t){if(!(t instanceof HTMLElement))throw new Error("Element is not a node element.");return null!==t.parentNode},Y=function(t,e,r){if(!(t instanceof HTMLElement&&t.parentElement instanceof HTMLElement))throw new Error("target and element must be a node");t.parentElement.insertBefore(e,"before"===r?t:t.nextElementSibling)},B=function(t,e){return Y(t,e,"after")},k=function(t){if(!(t instanceof HTMLElement))throw new Error("You must provide a valid dom element");var e=window.getComputedStyle(t);return"border-box"===e.getPropertyValue("box-sizing")?parseInt(e.getPropertyValue("height"),10):["height","padding-top","padding-bottom"].map((function(t){var r=parseInt(e.getPropertyValue(t),10);return isNaN(r)?0:r})).reduce((function(t,e){return t+e}))},N=function(t){if(!(t instanceof HTMLElement))throw new Error("You must provide a valid dom element");var e=window.getComputedStyle(t);return["width","padding-left","padding-right"].map((function(t){var r=parseInt(e.getPropertyValue(t),10);return isNaN(r)?0:r})).reduce((function(t,e){return t+e}))},z=function(t,e){if(!(t instanceof Array))throw new Error("You must provide a Array of HTMLElements to be filtered.");return"string"!=typeof e?t:t.filter((function(t){return t.querySelector(e)instanceof HTMLElement||t.shadowRoot&&t.shadowRoot.querySelector(e)instanceof HTMLElement})).map((function(t){return t.querySelector(e)||t.shadowRoot&&t.shadowRoot.querySelector(e)}))},q=function(t){return t.composedPath&&t.composedPath()[0]||t.target},W=function(t,e,r){return{element:t,posX:r.pageX-e.left,posY:r.pageY-e.top}},R=function(t,e){if(!0===t.isSortable){var r=w(t).getConfig("acceptFrom");if(null!==r&&!1!==r&&"string"!=typeof r)throw new Error('HTML5Sortable: Wrong argument, "acceptFrom" must be "null", "false", or a valid selector string.');if(null!==r)return!1!==r&&r.split(",").filter((function(t){return t.length>0&&e.matches(t)})).length>0;if(t===e)return!0;if(void 0!==w(t).getConfig("connectWith")&&null!==w(t).getConfig("connectWith"))return w(t).getConfig("connectWith")===w(e).getConfig("connectWith")}return!1},U={items:null,connectWith:null,disableIEFix:null,acceptFrom:null,copy:!1,placeholder:null,placeholderClass:"sortable-placeholder",draggingClass:"sortable-dragging",hoverClass:!1,dropTargetContainerClass:!1,debounce:0,throttleTime:100,maxItems:0,itemSerializer:void 0,containerSerializer:void 0,customDragImage:null,orientation:"vertical"},X=function(t){T(t,"dragstart"),T(t,"dragend"),T(t,"dragover"),T(t,"dragenter"),T(t,"drop"),T(t,"mouseenter"),T(t,"mouseleave")},G=function(t,e){t&&T(t,"dragleave"),e&&e!==t&&T(e,"dragleave")},V=function(t){var e;(e=t).h5s&&delete e.h5s.data,C(t,"aria-dropeffect")},J=function(t){C(t,"aria-grabbed"),C(t,"aria-copied"),C(t,"draggable"),C(t,"role")};function K(t,e){if(e.composedPath)return e.composedPath().find((function(t){return t.isSortable}));for(;!0!==t.isSortable;)t=t.parentElement;return t}function Q(t,e){var r=g(t,"opts"),n=v(t.children,r.items).filter((function(t){return t.contains(e)||t.shadowRoot&&t.shadowRoot.contains(e)}));return n.length>0?n[0]:e}var Z=function(t){var e=g(t,"opts"),r=v(t.children,e.items),n=z(r,e.handle);x(t,"aria-dropeffect","move"),g(t,"_disabled","false"),x(n,"draggable","true"),!1===e.disableIEFix&&"function"==typeof(document||window.document).createElement("span").dragDrop&&E(n,"mousedown",(function(){if(-1!==r.indexOf(this))this.dragDrop();else{for(var t=this.parentElement;-1===r.indexOf(t);)t=t.parentElement;t.dragDrop()}}))};function $(t,e){var r=String(e);return e=e||{},"string"==typeof t&&(t=document.querySelectorAll(t)),t instanceof HTMLElement&&(t=[t]),t=Array.prototype.slice.call(t),/serialize/.test(r)?t.map((function(t){var e=g(t,"opts");return function(t,e,r){if(void 0===e&&(e=function(t,e){return t}),void 0===r&&(r=function(t){return t}),!(t instanceof HTMLElement)||1==!t.isSortable)throw new Error("You need to provide a sortableContainer to be serialized.");if("function"!=typeof e||"function"!=typeof r)throw new Error("You need to provide a valid serializer for items and the container.");var n=g(t,"opts").items,o=v(t.children,n),i=o.map((function(e){return{parent:t,node:e,html:e.outerHTML,index:H(e,o)}}));return{container:r({node:t,itemCount:i.length}),items:i.map((function(r){return e(r,t)}))}}(t,e.itemSerializer,e.containerSerializer)})):(t.forEach((function(t){if(/enable|disable|destroy/.test(r))return $[r](t);["connectWith","disableIEFix"].forEach((function(t){Object.prototype.hasOwnProperty.call(e,t)&&null!==e[t]&&console.warn('HTML5Sortable: You are using the deprecated configuration "'+t+'". This will be removed in an upcoming version, make sure to migrate to the new options when updating.')})),e=Object.assign({},U,w(t).config,e),w(t).config=e,g(t,"opts",e),t.isSortable=!0,function(t){var e=g(t,"opts"),r=v(t.children,e.items),n=z(r,e.handle);g(t,"_disabled","false"),X(r),G(A,D),T(n,"mousedown"),T(t,"dragover"),T(t,"dragenter"),T(t,"drop")}(t);var n,o=v(t.children,e.items);if(null!==e.placeholder&&void 0!==e.placeholder){var i=document.createElement(t.tagName);e.placeholder instanceof HTMLElement?i.appendChild(e.placeholder):i.innerHTML=e.placeholder,n=i.children[0]}w(t).placeholder=function(t,e,r){var n;if(void 0===r&&(r="sortable-placeholder"),!(t instanceof HTMLElement))throw new Error("You must provide a valid element as a sortable.");if(!(e instanceof HTMLElement)&&void 0!==e)throw new Error("You must provide a valid element as a placeholder or set ot to undefined.");return void 0===e&&(["UL","OL"].includes(t.tagName)?e=document.createElement("li"):["TABLE","TBODY"].includes(t.tagName)?(e=document.createElement("tr")).innerHTML='<td colspan="100"></td>':e=document.createElement("div")),"string"==typeof r&&(n=e.classList).add.apply(n,r.split(" ")),e}(t,n,e.placeholderClass),g(t,"items",e.items),e.acceptFrom?g(t,"acceptFrom",e.acceptFrom):e.connectWith&&g(t,"connectWith",e.connectWith),Z(t),x(o,"role","option"),x(o,"aria-grabbed","false"),function(t,e){if("string"==typeof w(t).getConfig("hoverClass")){var r=w(t).getConfig("hoverClass").split(" ");!0===e?(E(t,"mousemove",function(t,e){var r=this;if(void 0===e&&(e=250),"number"!=typeof e)throw new Error("You must provide a number as the second argument for throttle.");var n=null;return function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];var a=Date.now();(null===n||a-n>=e)&&(n=a,t.apply(r,o))}}((function(e){0===e.buttons&&v(t.children,w(t).getConfig("items")).forEach((function(t){var n,o;t!==e.target?(n=t.classList).remove.apply(n,r):(o=t.classList).add.apply(o,r)}))}),w(t).getConfig("throttleTime"))),E(t,"mouseleave",(function(){v(t.children,w(t).getConfig("items")).forEach((function(t){var e;(e=t.classList).remove.apply(e,r)}))}))):(T(t,"mousemove"),T(t,"mouseleave"))}}(t,!0),E(t,"dragstart",(function(t){var r=q(t);if(!0!==r.isSortable&&(t.stopImmediatePropagation(),(!e.handle||r.matches(e.handle))&&"false"!==r.getAttribute("draggable"))){var n=K(r,t),o=Q(n,r);M=v(n.children,e.items),P=M.indexOf(o),S=H(o,n.children),A=n,function(t,e,r){if(!(t instanceof Event))throw new Error("setDragImage requires a DragEvent as the first argument.");if(!(e instanceof HTMLElement))throw new Error("setDragImage requires the dragged element as the second argument.");if(r||(r=W),t.dataTransfer&&t.dataTransfer.setDragImage){var n=r(e,O(e),t);if(!(n.element instanceof HTMLElement)||"number"!=typeof n.posX||"number"!=typeof n.posY)throw new Error("The customDragImage function you provided must return and object with the properties element[string], posX[integer], posY[integer].");t.dataTransfer.effectAllowed="copyMove",t.dataTransfer.setData("text/plain",q(t).id),t.dataTransfer.setDragImage(n.element,n.posX,n.posY)}}(t,o,e.customDragImage),F=k(o),L=N(o),o.classList.add(e.draggingClass),_=function(t,e){var r=t;return!0===w(e).getConfig("copy")&&(x(r=t.cloneNode(!0),"aria-copied","true"),t.parentElement.appendChild(r),r.style.display="none",r.oldDisplay=t.style.display),r}(o,n),x(_,"aria-grabbed","true"),n.dispatchEvent(new CustomEvent("sortstart",{detail:{origin:{elementIndex:S,index:P,container:A},item:_,originalTarget:r}}))}})),E(t,"dragenter",(function(r){var n=q(r),o=K(n,r);o&&o!==D&&(I=v(o.children,g(o,"items")).filter((function(e){return e!==w(t).placeholder})),e.dropTargetContainerClass&&o.classList.add(e.dropTargetContainerClass),o.dispatchEvent(new CustomEvent("sortenter",{detail:{origin:{elementIndex:S,index:P,container:A},destination:{container:o,itemsBeforeUpdate:I},item:_,originalTarget:n}})),E(o,"dragleave",(function(t){var r=t.relatedTarget||t.fromElement;t.currentTarget.contains(r)||(e.dropTargetContainerClass&&o.classList.remove(e.dropTargetContainerClass),o.dispatchEvent(new CustomEvent("sortleave",{detail:{origin:{elementIndex:S,index:P,container:o},item:_,originalTarget:n}})))}))),D=o})),E(t,"dragend",(function(r){if(_){_.classList.remove(e.draggingClass),x(_,"aria-grabbed","false"),"true"===_.getAttribute("aria-copied")&&"true"!==g(_,"dropped")&&_.remove(),_.style.display=_.oldDisplay,delete _.oldDisplay;var n=Array.from(y.values()).map((function(t){return t.placeholder})).filter((function(t){return t instanceof HTMLElement})).filter(j)[0];n&&n.remove(),t.dispatchEvent(new CustomEvent("sortstop",{detail:{origin:{elementIndex:S,index:P,container:A},item:_}})),D=null,_=null,F=null,L=null}})),E(t,"drop",(function(r){if(R(t,_.parentElement)){r.preventDefault(),r.stopPropagation(),g(_,"dropped","true");var n=Array.from(y.values()).map((function(t){return t.placeholder})).filter((function(t){return t instanceof HTMLElement})).filter(j)[0];B(n,_),n.remove(),t.dispatchEvent(new CustomEvent("sortstop",{detail:{origin:{elementIndex:S,index:P,container:A},item:_}}));var o=w(t).placeholder,i=v(A.children,e.items).filter((function(t){return t!==o})),a=!0===this.isSortable?this:this.parentElement,s=v(a.children,g(a,"items")).filter((function(t){return t!==o})),l=H(_,Array.from(_.parentElement.children).filter((function(t){return t!==o}))),c=H(_,s);e.dropTargetContainerClass&&a.classList.remove(e.dropTargetContainerClass),S===l&&A===a||t.dispatchEvent(new CustomEvent("sortupdate",{detail:{origin:{elementIndex:S,index:P,container:A,itemsBeforeUpdate:M,items:i},destination:{index:c,elementIndex:l,container:a,itemsBeforeUpdate:I,items:s},item:_}}))}}));var a,s,l,c=(a=function(t,r,n,o){if(_)if(e.forcePlaceholderSize&&(w(t).placeholder.style.height=F+"px",w(t).placeholder.style.width=L+"px"),Array.from(t.children).indexOf(r)>-1){var i=k(r),a=N(r),s=H(w(t).placeholder,r.parentElement.children),l=H(r,r.parentElement.children);if(i>F||a>L){var c=i-F,d=a-L,u=O(r).top,p=O(r).left;if(s<l&&("vertical"===e.orientation&&o<u||"horizontal"===e.orientation&&n<p))return;if(s>l&&("vertical"===e.orientation&&o>u+i-c||"horizontal"===e.orientation&&n>p+a-d))return}void 0===_.oldDisplay&&(_.oldDisplay=_.style.display),"none"!==_.style.display&&(_.style.display="none");var f=!1;try{var m=O(r).top+r.offsetHeight/2,h=O(r).left+r.offsetWidth/2;f="vertical"===e.orientation&&o>=m||"horizontal"===e.orientation&&n>=h}catch(t){f=s<l}f?B(r,w(t).placeholder):function(t,e){Y(t,e,"before")}(r,w(t).placeholder),Array.from(y.values()).filter((function(t){return void 0!==t.placeholder})).forEach((function(e){e.placeholder!==w(t).placeholder&&e.placeholder.remove()}))}else{var g=Array.from(y.values()).filter((function(t){return void 0!==t.placeholder})).map((function(t){return t.placeholder}));-1!==g.indexOf(r)||t!==r||v(r.children,e.items).length||(g.forEach((function(t){return t.remove()})),r.appendChild(w(t).placeholder))}},void 0===(s=e.debounce)&&(s=0),function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];clearTimeout(l),l=setTimeout((function(){a.apply(void 0,t)}),s)}),d=function(t){var e=t.target,r=!0===e.isSortable?e:K(e,t);if(e=Q(r,e),_&&R(r,_.parentElement)&&"true"!==g(r,"_disabled")){var n=g(r,"opts");parseInt(n.maxItems)&&v(r.children,g(r,"items")).length>=parseInt(n.maxItems)&&_.parentElement!==r||(t.preventDefault(),t.stopPropagation(),t.dataTransfer.dropEffect=!0===w(r).getConfig("copy")?"copy":"move",c(r,e,t.pageX,t.pageY))}};E(o.concat(t),"dragover",d),E(o.concat(t),"dragenter",d)})),t)}$.destroy=function(t){!function(t){var e=g(t,"opts")||{},r=v(t.children,e.items),n=z(r,e.handle);T(t,"dragover"),T(t,"dragenter"),T(t,"dragstart"),T(t,"dragend"),T(t,"drop"),V(t),T(n,"mousedown"),X(r),J(r),G(A,D),t.isSortable=!1}(t)},$.enable=function(t){Z(t)},$.disable=function(t){!function(t){var e=g(t,"opts"),r=v(t.children,e.items),n=z(r,e.handle);x(t,"aria-dropeffect","none"),g(t,"_disabled","true"),x(n,"draggable","false"),T(n,"mousedown")}(t)},$.__testing={_data:g,_removeItemEvents:X,_removeItemData:J,_removeSortableData:V,_removeContainerEvents:G};const tt=$,et=flarum.core.compat["common/helpers/icon"];var rt=t.n(et);const nt=flarum.core.compat["common/utils/extractText"];var ot=t.n(nt);const it=flarum.core.compat["common/utils/ItemList"];var at=t.n(it);const st=flarum.core.compat["common/utils/withAttr"];var lt=t.n(st);const ct=flarum.core.compat["common/components/Button"];var dt=t.n(ct),ut=function(){function t(){}var e=t.prototype;return e.oninit=function(t){this.policy=t.attrs.policy,this.dirty=!1,this.processing=!1,this.toggleFields=!1,null===this.policy&&this.initNewField()},e.initNewField=function(){this.policy=n().store.createRecord("fof-terms-policies",{attributes:{name:"",url:"",update_message:"",terms_updated_at:"",optional:!1,additional_info:{}}})},e.boxTitle=function(){return this.policy.exists?this.policy.name():n().translator.trans("fof-terms.admin.buttons.new-policy")},e.view=function(){var t=this;return m(".FoF-Terms-Policiy-Box",[this.policy.exists?m("span.fas.fa-arrows-alt.FoF-Terms-Policiy-Box--handle.js-policy-handle"):null,m(".Button.Button--block.FoF-Terms-Policiy-Header",{onclick:function(){t.toggleFields=!t.toggleFields}},[m(".FoF-Terms-Policiy-Header-Title",this.boxTitle()),m("div",[this.policy.exists?[n().translator.trans("fof-terms.admin.buttons.edit-policy")," "]:null,rt()(this.toggleFields?"fas fa-chevron-up":"fas fa-chevron-down")])]),this.toggleFields?this.viewFields():null])},e.viewFields=function(){var t=this;return m("form.FoF-Terms-Policiy-Body",{onsubmit:this.savePolicy.bind(this)},[this.fields().toArray(),m(".ButtonGroup",[dt().component({type:"submit",className:"Button Button--primary",loading:this.processing,disabled:!this.readyToSave()},n().translator.trans("fof-terms.admin.buttons."+(this.policy.exists?"save":"add")+"-policy")),this.policy.exists?dt().component({type:"submit",className:"Button Button--danger",loading:this.processing,onclick:function(e){return t.deletePolicy(e)}},n().translator.trans("fof-terms.admin.buttons.delete-policy")):""])])},e.fields=function(){var t=this,e=new(at());return e.add("name",m(".Form-group",[m("label",n().translator.trans("fof-terms.admin.policies.name")),m("input.FormControl",{type:"text",value:this.policy.name(),oninput:lt()("value",this.updateAttribute.bind(this,"name"))}),m(".helpText",n().translator.trans("fof-terms.admin.policies.name-help"))]),100),e.add("url",m(".Form-group",[m("label",n().translator.trans("fof-terms.admin.policies.url")),m("input.FormControl",{type:"url",value:this.policy.url(),oninput:lt()("value",this.updateAttribute.bind(this,"url"))}),m(".helpText",n().translator.trans("fof-terms.admin.policies.url-help"))]),95),e.add("update-message",m(".Form-group",[m("label",n().translator.trans("fof-terms.admin.policies.update-message")),m("textarea.FormControl",{value:this.policy.update_message(),oninput:lt()("value",this.updateAttribute.bind(this,"update_message"))}),m(".helpText",n().translator.trans("fof-terms.admin.policies.update-message-help"))]),90),e.add("terms-updated-at",m(".Form-group",[m("label",n().translator.trans("fof-terms.admin.policies.terms-updated-at")),m(".FoF-Terms-Input-Group",[m("input.FormControl",{type:"text",value:this.policy.terms_updated_at(),oninput:lt()("value",this.updateAttribute.bind(this,"terms_updated_at")),placeholder:n().translator.trans("fof-terms.admin.policies.terms-updated-at-placeholder")}),dt().component({className:"Button Button--primary",onclick:function(){t.updateAttribute("terms_updated_at",dayjs().millisecond(0).toISOString())}},n().translator.trans("fof-terms.admin.buttons.set-to-now"))]),m(".helpText",n().translator.trans("fof-terms.admin.policies.terms-updated-at-help"))]),85),e.add("optional",m("[",null,m("div",{class:"Form-group"},m("div",{class:" fof-terms-optional-checkbox"},m("label",{class:"Form-group>label"},n().translator.trans("fof-terms.admin.policies.optional")),m(h(),{className:"fof-terms-Switch-off",state:this.policy.optional(),onchange:function(){t.updateAttribute("optional",!t.policy.optional())}})),m("div",{class:"helpText"},n().translator.trans("fof-terms.admin.policies.optional-help")))),83),this.policy.exists&&e.add("export-url",m(".Form-group",[m("label",n().translator.trans("fof-terms.admin.policies.export-url")),m(".ButtonGroup",["json","csv"].map((function(e){return m("a.Button.FoF-Terms-Export-Button",{href:n().forum.attribute("apiUrl")+"/fof/terms/policies/"+t.policy.id()+"/export."+e,target:"_blank"},e.toUpperCase())}))),m(".helpText",n().translator.trans("fof-terms.admin.policies.export-url-help",{a:m("a",{href:"https://github.com/FriendsOfFlarum/terms/wiki/Export-url",target:"_blank"})}))]),80),e},e.updateAttribute=function(t,e){var r;this.policy.pushAttributes(((r={})[t]=e,r)),this.dirty=!0},e.readyToSave=function(){return this.dirty},e.savePolicy=function(t){var e=this;t.preventDefault(),this.processing=!0;var r=!this.policy.exists;this.policy.save(this.policy.data.attributes).then((function(){r&&(e.initNewField(),e.toggleFields=!1),e.processing=!1,e.dirty=!1,m.redraw()})).catch((function(t){throw e.processing=!1,t}))},e.deletePolicy=function(t){var e=this;t.preventDefault(),confirm(ot()(n().translator.trans("fof-terms.admin.messages.delete-policy-confirmation",{name:this.policy.name()})))&&(this.processing=!0,this.policy.delete().then((function(){e.processing=!1,m.redraw()})).catch((function(t){throw e.processing=!1,t})))},t}();function pt(t,e){return void 0===e&&(e="sort"),t.sort((function(t,r){return t[e]()-r[e]()}))}var ft=function(){function t(){}var e=t.prototype;return e.oninit=function(){n().request({method:"GET",url:n().forum.attribute("apiUrl")+"/fof/terms/policies"}).then((function(t){n().store.pushPayload(t),m.redraw()}))},e.oncreate=function(t){this.initsortable(t)},e.onupdate=function(t){this.initsortable(t)},e.initsortable=function(t){var e=this;tt(t.dom.querySelector(".js-policies-container"),{handle:".js-policy-handle"})[0].addEventListener("sortupdate",(function(){var r=[].map.call(t.dom.querySelectorAll(".js-policy-data"),(function(t){return t.dataset.id}));e.updateSort(r)}))},e.view=function(){var t=n().store.all("fof-terms-policies"),e=[];return pt(t).forEach((function(t){e.push(m(".js-policy-data",{key:t.id(),"data-id":t.id()},m(ut,{policy:t})))})),m("div",[m("h2",n().translator.trans("fof-terms.admin.titles.policies")),m(".FoF-Terms-Policies-Container",[m(".js-policies-container",e),m(ut,{policy:null})])])},e.updateSort=function(t){n().request({method:"POST",url:n().forum.attribute("apiUrl")+"/fof/terms/policies/order",body:{sort:t}}).then((function(t){n().store.pushPayload(t),m.redraw()}))},t}(),mt="fof-terms.",ht="fof-terms.admin.settings.",gt=function(t){function e(){return t.apply(this,arguments)||this}return i(e,t),e.prototype.content=function(){return m(".ExtensionPage-settings",[m(".container",[m(".Form-group",[m("label",n().translator.trans(ht+"field.signup-legal-text")),m("textarea.FormControl",{bidi:this.setting(mt+"signup-legal-text")})]),m(".Form-group",[m("label",h().component({state:this.setting(mt+"hide-updated-at")()>0,onchange:this.setting(mt+"hide-updated-at")},n().translator.trans(ht+"field.hide-updated-at")))]),m(".Form-group",[m("label",n().translator.trans(ht+"field.date-format")),m("input[type=text].FormControl",{bidi:this.setting(mt+"date-format"),placeholder:"YYYY-MM-DD"}),m(".helpText",n().translator.trans(ht+"field.date-format-help",{a:m("a",{href:"https://day.js.org/docs/en/display/format",target:"_blank"})}))]),this.submitButton(),m(ft)])])},e}(p());const vt=flarum.core.compat["common/Component"];var yt=function(t){function e(){return t.apply(this,arguments)||this}i(e,t);var r=e.prototype;return r.oninit=function(e){t.prototype.oninit.call(this,e),this.keyattr=e.attrs.keyattr,this.policy=e.attrs.policy,this.setDirty=e.attrs.setDirty,this.children=e.children,this.updateAttribute=this.updateAttribute.bind(this)},r.view=function(){var t="function"==typeof this.children[0]?this.children[0]({keyattr:this.keyattr,policy:this.policy,updateAttribute:this.updateAttribute}):this.children;return m("div",{class:"Form-group"},t)},r.updateAttribute=function(t){var e,r=this.policy.additional_info();r[this.keyattr]=t,this.policy.pushAttributes(((e={}).additional_info=r,e)),this.setDirty()},e}(t.n(vt)()),bt={PolicyEdit:ut,PolicyList:ft,TermsSettingsPage:gt,ExtensionData:yt},wt={Policy:d},Et={sortByAttribute:pt};n().initializers.add("fof-terms",(function(){n().store.models["fof-terms-policies"]=d,n().extensionData.for("fof-terms").registerPermission({icon:"fas fa-paperclip",label:n().translator.trans("fof-terms.admin.permissions.see-user-policies-state"),permission:"fof-terms.see-user-policies-state"},"moderate").registerPermission({icon:"fas fa-paperclip",label:n().translator.trans("fof-terms.admin.permissions.postpone-policies-accept"),permission:"fof-terms.postpone-policies-accept"},"moderate").registerPermission({icon:"fas fa-paperclip",label:n().translator.trans("fof-terms.admin.permissions.export-policies"),permission:"fof-terms.export-policies"},"moderate").registerPage(gt)}))})(),module.exports=e})();
//# sourceMappingURL=admin.js.map