(()=>{var t={n:o=>{var e=o&&o.__esModule?()=>o.default:()=>o;return t.d(e,{a:e}),e},d:(o,e)=>{for(var r in e)t.o(e,r)&&!t.o(o,r)&&Object.defineProperty(o,r,{enumerable:!0,get:e[r]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},o={};(()=>{"use strict";t.r(o),t.d(o,{components:()=>G,helpers:()=>K,models:()=>J});const e=flarum.core.compat["forum/app"];var r=t.n(e);const n=flarum.core.compat["common/Model"];var a=t.n(n);const s=flarum.core.compat["common/models/User"];var c=t.n(s);function i(t,o){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t},i(t,o)}function f(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,i(t,o)}const u=flarum.core.compat["common/utils/computed"];var l=t.n(u),p=function(t){function o(){for(var o,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(o=t.call.apply(t,[this].concat(r))||this).sort=a().attribute("sort"),o.name=a().attribute("name"),o.url=a().attribute("url"),o.update_message=a().attribute("update_message"),o.terms_updated_at=a().attribute("terms_updated_at"),o.form_key=l()("id",(function(t){return"fof_terms_policy_"+t})),o}return f(o,t),o.prototype.apiEndpoint=function(){return"/fof/terms/policies"+(this.exists?"/"+this.data.id:"")},o}(a());const d=flarum.core.compat["common/extend"],y=flarum.core.compat["common/components/Page"];var h=t.n(y);const v=flarum.core.compat["common/components/IndexPage"];var b=t.n(v);const _=flarum.core.compat["common/components/Modal"];var P=t.n(_);const g=flarum.core.compat["common/components/Button"];var k=t.n(g);function T(t,o){return void 0===o&&(o="sort"),t.sort((function(t,e){return t[o]()-e[o]()}))}var A=function(t){function o(){return t.apply(this,arguments)||this}f(o,t);var e=o.prototype;return e.oninit=function(o){var e=this;t.prototype.oninit.call(this,o),r().store.all("fof-terms-policies").forEach((function(t){e[t.form_key()]=!1}))},e.title=function(){return r().translator.trans("fof-terms.forum.accept-modal.title")},e.className=function(){return"AcceptPoliciesModal Modal--medium"},e.content=function(){return m(".Modal-body",this.body())},e.body=function(){var t=this,o=T(r().store.all("fof-terms-policies").filter((function(t){var o=r().session.user.fofTermsPoliciesState()[t.id()];return!o||o.has_update})));return 0===o.length?k().component({className:"Button",onclick:function(){r().modal.close()}},r().translator.trans("fof-terms.forum.accept-modal.close")):o.map((function(e){return m("div",[m("h2",e.name()),r().forum.attribute("fof-terms.hide-updated-at")?null:m("p",e.terms_updated_at()?r().translator.trans("fof-terms.forum.accept-modal.updated-at",{date:dayjs(e.terms_updated_at()).format(r().forum.attribute("fof-terms.date-format"))}):r().translator.trans("fof-terms.forum.accept-modal.updated-recently")),e.update_message()?m("p",e.update_message()):null,m(".Form-group",m(".FoF-Terms-Check.FoF-Terms-Check--login",m("label.checkbox",[m("input",{type:"checkbox",checked:t[e.form_key()],onchange:function(){t[e.form_key()]=!t[e.form_key()]}}),r().translator.trans("fof-terms.forum.accept-modal.i-accept",{policy:e.name(),a:e.url()?m("a",{href:e.url(),target:"_blank"}):m("span")})]))),k().component({className:"Button Button--primary",disabled:!t[e.form_key()],onclick:function(){var n=r().session.user.fofTermsPoliciesMustAccept();r().request({url:r().forum.attribute("apiUrl")+e.apiEndpoint()+"/accept",method:"POST",errorHandler:t.onerror.bind(t)}).then((function(t){r().store.pushPayload(t),1===o.length&&(n?window.location.reload():r().modal.close()),m.redraw()}))}},r().translator.trans("fof-terms.forum.accept-modal.accept"))])}))},o}(P());const M=flarum.core.compat["forum/components/SignUpModal"];var S=t.n(M);const F=flarum.core.compat["forum/components/IndexPage"];var x=t.n(F);const w=flarum.core.compat["forum/components/DiscussionPage"];var U=t.n(w);const O=flarum.core.compat["forum/components/UserPage"];var B=t.n(O);const j=flarum.core.compat["common/helpers/listItems"];var C=t.n(j),E=!1,N=function(){function t(){}var o=t.prototype;return o.shouldShowAlert=function(){if(E)return!1;var t=r().session.user;return t&&t.fofTermsPoliciesHasUpdate()},o.view=function(){if(!this.shouldShowAlert())return m("div");var t=[k().component({className:"Button Button--link",onclick:function(){r().modal.show(A)}},r().translator.trans("fof-terms.forum.update-alert.review"))],o=[];return r().session.user.fofTermsPoliciesMustAccept()||o.push(k().component({icon:"fas fa-times",className:"Button Button--link Button--icon Alert-dismiss",onclick:function(){E=!0}})),m(".Alert.Alert-info",m(".container",[m("span.Alert-body",r().session.user.fofTermsPoliciesMustAccept()?r().translator.trans("fof-terms.forum.update-alert.must-accept-message"):r().translator.trans("fof-terms.forum.update-alert.can-accept-message")),m("ul.Alert-controls",C()(t.concat(o)))]))},t}();function H(t){for(var o=arguments.length,e=new Array(o>1?o-1:0),r=1;r<o;r++)e[r-1]=arguments[r];var n=t.apply(void 0,e),a=m(N);return Array.isArray(n)?(n.unshift(a),n):m("div",[a,n])}const I=flarum.core.compat["forum/utils/UserControls"];var D=t.n(I);const q=flarum.core.compat["common/helpers/humanTime"];var z=t.n(q),L=function(t){function o(){return t.apply(this,arguments)||this}f(o,t);var e=o.prototype;return e.title=function(){return r().translator.trans("fof-terms.forum.state-modal.title",{username:this.attrs.user.username()})},e.className=function(){return"UserPoliciesStateModal Modal--medium"},e.content=function(){var t=this;return m(".Modal-body",m("ul",T(r().store.all("fof-terms-policies")).map((function(o){var e=t.attrs.user.fofTermsPoliciesState()[o.id()];return m("li",[o.name()+": ",e&&e.accepted_at?r().translator.trans("fof-terms.forum.state-modal.accepted-at",{date:z()(e.accepted_at)}):r().translator.trans("fof-terms.forum.state-modal.not-accepted")])}))))},o}(P()),G={AcceptPoliciesModal:A,UpdateAlert:N,UserPoliciesStateModal:L},J={Policy:p},K={sortByAttribute:T};r().initializers.add("fof-terms",(function(){var t;r().store.models["fof-terms-policies"]=p,c().prototype.fofTermsPoliciesState=a().attribute("fofTermsPoliciesState"),c().prototype.fofTermsPoliciesHasUpdate=a().attribute("fofTermsPoliciesHasUpdate"),c().prototype.fofTermsPoliciesMustAccept=a().attribute("fofTermsPoliciesMustAccept"),c().prototype.seeFoFTermsPoliciesState=a().attribute("seeFoFTermsPoliciesState"),t=!1,(0,d.extend)(h().prototype,"oninit",(function(){if(!t){if(r().current.matches(b())){var o=r().session.user;o&&o.fofTermsPoliciesMustAccept()&&setTimeout((function(){r().modal.show(A)}),0)}t=!0}})),(0,d.extend)(S().prototype,"oninit",(function(){var t=this;this.fofTermsPolicies=T(r().store.all("fof-terms-policies")),this.fofTermsPolicies.forEach((function(o){t[o.form_key()]=!1}))})),(0,d.extend)(S().prototype,"fields",(function(t){var o=this,e=r().forum.attribute("fof-terms.signup-legal-text");e&&t.add("fof-terms-legal-text",m(".Form-group",m(".FoF-Terms-SignUp-Legal.Alert",e))),this.fofTermsPolicies.forEach((function(e){t.add("fof-terms-policy-"+e.id(),m(".Form-group",m(".FoF-Terms-Check.FoF-Terms-Check--signup",m("label.checkbox",[m("input",{type:"checkbox",checked:o[e.form_key()],onchange:function(){o[e.form_key()]=!o[e.form_key()]},disabled:o.loading}),r().translator.trans("fof-terms.forum.signup.i-accept",{policy:e.name(),a:e.url()?m("a",{href:e.url(),target:"_blank"}):m("span")})]))))}))})),(0,d.extend)(S().prototype,"submitData",(function(t){var o=this;this.fofTermsPolicies.forEach((function(e){t[e.form_key()]=o[e.form_key()]}))})),(0,d.override)(x().prototype,"hero",H),(0,d.override)(U().prototype,"view",H),(0,d.override)(B().prototype,"view",H),(0,d.extend)(D(),"moderationControls",(function(t,o){r().forum.attribute("fof-terms.canSeeUserPoliciesState")&&t.add("fof-terms.state",k().component({icon:"fas fa-paperclip",onclick:function(){r().modal.show(L,{user:o})}},r().translator.trans("fof-terms.forum.user_controls.state_button")))}))}))})(),module.exports=o})();
//# sourceMappingURL=forum.js.map